<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Managing - Corpora</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Managing";
        var mkdocs_page_input_path = "managing.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../assets/logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rest_api/">REST API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deploying/">Deploying</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Managing</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#managing-users">Managing Users</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#grantingrevoking-admin-privileges">Granting/Revoking Admin Privileges</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grantingrevoking-corpus-permissions">Granting/Revoking Corpus Permissions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grantingrevoking-job-permissions">Granting/Revoking Job Permissions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#changing-passwords">Changing Passwords</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backing-up-and-restoring-corpus-data">Backing Up and Restoring Corpus Data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backing-up">Backing Up</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restoring">Restoring</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installing-plugins">Installing Plugins</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#scaling-corpora">Scaling Corpora</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../developing/">Developing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../corpus_api/">Corpus API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../plugins/">Plugins</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Corpora</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Managing</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/bptarpley/corpora/edit/master/docs/managing.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="managing">Managing</h1>
<p>There are a few tasks, such as managing users, backing up and restoring corpus data, and installing plugins that Corpora admins may need to perform.</p>
<h2 id="managing-users">Managing Users</h2>
<p>To manage the users (or Scholars) on your instance of Corpora, click the blue "Manage Scholars" button in the footer of the table listing corpora on the homepage of the web application.</p>
<p>Once on the "Scholars" page, you should see a table listing all the users in your instance of Corpora. You may click on the column names to sort, you can use the search box, or page through this list in order to find your user. Once you've found them, click on their username which should also be an orange link. This will bring up the "Manage Scholar" modal.</p>
<h3 id="grantingrevoking-admin-privileges">Granting/Revoking Admin Privileges</h3>
<p>Admins in Corpora are able to create a new corpus, view and edit all data for existing corpora, run all corpus notebooks, and run all tasks. You can make a user an admin for your instance of Corpora by clicking the orange "Grant Admin Privileges" button. Once a user is an admin, that same button will read "Revoke Admin Privileges."</p>
<h3 id="grantingrevoking-corpus-permissions">Granting/Revoking Corpus Permissions</h3>
<p>In order for a user to edit content, run a corpus notebook, or run certain tasks, they must either be an Admin for the instance of Corpora or be granted "Editor" privileges on a specific corpus. To do the latter, expand the "Corpus permissions" tray. In the "New Permission" form, provide the name of the corpus, choose "Editor" from the dropdown menu, and click "Set Permission." To revoke that privilege, find it under "Existing Permissions" and choose "None" from the dropdown.</p>
<h3 id="grantingrevoking-job-permissions">Granting/Revoking Job Permissions</h3>
<p>While admins can run all jobs, users with Editor permissions on a corpus must be explicitly granted permission to run specific jobs. To do so, expand out the user's "Job permissions" tray. You can either check the box next to the specific task they need to be able to run, or check the "Local (HUEY)" box, which grants them privileges to run every local task. Once you've checked the appropriate box(es), click the orange "Set Permissions" button. Job permissions can be revoked by unchecking boxes and clicking "Set Permissions" again.</p>
<h3 id="changing-passwords">Changing Passwords</h3>
<p>When logged in, individual users can change their passwords by clicking on the orange "My Account" button on the top right of a page in Corpora. Should they need their passwords reset, however, you may do so by pulling up their "Manage Scholar" modal and expanding the "Change password" tray. You may then provide their new password, confirm it, and click the "Change Password" button.</p>
<h2 id="backing-up-and-restoring-corpus-data">Backing Up and Restoring Corpus Data</h2>
<p>When logged in as user with admin privileges, you should see several buttons on the footer of the table that lists all of the corpora on the home page of your instance of Corpora. To back up or restore corpus data, click the blue "Corpus Backups" button to manage corpus backups.</p>
<h3 id="backing-up">Backing Up</h3>
<p>Corpus data can be backed up as a "gzipped tar file," which includes metadata about your corpus, any files uploaded to your corpus or content types, and MongoDB database dumps of all the content in your corpus. To create an backup file, select the relevant corpus from the "Corpus" dropdown, provide a name (a default name is optionally provided for you), and click the orange "Create" button. Depending on how large your corpus is, this can take some time. Once an backup has been created, however, it should show up under "Existing Backups" beneath the creation form upon refreshing the page. Multiple backups for the same corpus may be created--they must, however, have unique names.</p>
<p>In order to restore a corpus or migrate it to another instance of Corpora, you may download the file by clicking on its orange link in the "Backup File" column of the Existing Backups table. It is strongly recommended that you do <em>not</em> rename this file after you download it.</p>
<h3 id="restoring">Restoring</h3>
<p>To restore a corpus backup, it must be listed in the "Existing Backups" table. If it's not listed there, scroll to the bottom of the page where it says "Import a Backup File." You may simply drag and drop your downloaded backup file into the gray box to make it available.* Once your backup file appears in the "Existing Backups" table, you may click the blue "Restore" button to the right of it to commence the restore process. Note that the restore process maintains the original unique ID assigned to your corpus at the time of creation. As such, if you already have a version of that corpus on your instance of Corpora, you must first delete it before performing a restore. To delete an existing corpus you must be logged in as an admin user. You can then go to that corpus' home page, click on the "Admin" tab, scroll to the bottom, and use the corpus deletion form.</p>
<p>Depending on the amount of data in your corpus, restoring can take a long time, as data is being restored to MongoDB, Elasticsearch, and Neo4J.</p>
<p>*<em>Note:</em> Certain very large corpus backup files (usually over 3GB in size) may cause the upload process to timeout, preventing you from registering it as an available corpus to restore. If this happens, you will have to register it manually. To do so, navigate to the data directory of your instance of Corpora as it exists on the machine/server hosting your instance, i.e. <code>/corpora/data</code>. Inside that directory will be several subdirectories such as "archive," "link," "search," etc. Go inside the subdirectory named "corpora" and find the directory named backups, i.e. <code>/corpora/data/corpora/backups</code>. Copy your large export file into this directory. You'll then have to execute a Django management command on the machine hosting Corpora by performing the following steps:</p>
<ol>
<li>Open a terminal or command prompt.</li>
<li>Determine the name of the container running Corpora. You can do that by running the command <code>docker ps</code>. This will output information about all the containers running on your machine. In the "NAMES" column of this output, you'll want to find the container name for Corpora, which will either be something like <code>corpora-corpora-1</code> if you're using Docker Compose, or <code>corpora_corpora.1.[alphanumeric id]</code> if you're using Docker Swarm. Make note of this container name.</li>
<li>Execute the following command in your terminal:</li>
</ol>
<pre><code class="language-bash">docker exec -it [container name] python3 manage.py register_backup_file [backup filename]
</code></pre>
<p>Note that when providing the backup filename in the command above, you only need the name of the file (not the full path). Once that command executes and you get a message saying "Backup file successfully registered," you should be able to see it listed as an available corpus backup to restore on the "Corpus Backups" page. </p>
<h2 id="installing-plugins">Installing Plugins</h2>
<p>Corpora is designed with a plugin architecture that leverages Django's "app" convention. As such, installing plugins for Corpora is relatively easy, though you must have access to the filesystem of the server. A given plugin is ultimately a directory with a particular file structure (see <a href="/corpora/developing/#building-corpora-plugins">creating plugins for Corpora</a>). To install a plugin, place its directory inside the "plugins" subdirectory living in the data directory for Corpora, i.e. <code>/corpora/data/plugins</code>. Once the plugin directory is copied there, you must also enable the plugin by adding it to the comma delimited list of enabled plugins stored in the <code>CRP_INSTALLED_PLUGINS</code> environment variable set for the Corpora container. The easiest way to do this is to edit the <code>docker-compose.yml</code> file, find the "environment" section of the "corpora" service, make sure the line specifying <code>CRP_INSTALLED_PLUGINS</code> isn't commented out, and add the name of the plugin directory to that variables' comma delimited value.</p>
<p><em>Corpora must be restarted</em> for it to be registered properly. And in order for containers to be aware of updated environment variables, the container must be stopped altogether and re-created by the Docker engine. To completely stop and restart Corpora while running with Docker Compose, issue these commands:</p>
<pre><code class="language-bash"># first change to your codebase directory with the docker-compose.yml file
docker-compose down
# wait 20 seconds or so for the containers to stop
docker-compose up -d
</code></pre>
<p>To completely stop and restart Corpora while running as a Swarm service, issue these commands:</p>
<pre><code class="language-bash"># first change to your codebase directory with the docker-compose.yml file
docker stack rm corpora
# wait 20 seconds or so for the containers to stop
docker stack deploy corpora -c docker-compose.yml
</code></pre>
<h2 id="scaling-corpora">Scaling Corpora</h2>
<p>Should your instance of Corpora receive high traffic volume, it is architected in such a way as to support multiple instances of the Corpora container--this is due to the fact that they all rely on the Redis container for session management. Scaling in this way has only been tested with a <a href="/corpora/deploying/#running-in-swarm-mode">Docker Swarm deployment</a>, and may be accomplished by setting the <code>scale</code> key in the service configuration for Corpora in <code>docker-compose.yml</code>, or by issuing <a href="https://docs.docker.com/engine/swarm/swarm-tutorial/scale-service/">the appropriate Docker command</a>. Scaling Corpora in this way will also multiply the number of Huey task workers you're able to run concurrently. You could alternatively scale Huey by increasing the number of Huey workers in a given Corpora container by setting the <code>CRP_HUEY_WORKERS</code> environment variable to something higher than the default, which is currently <code>10</code>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../deploying/" class="btn btn-neutral float-left" title="Deploying"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../developing/" class="btn btn-neutral float-right" title="Developing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/bptarpley/corpora" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../deploying/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../developing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
