{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Variorum Shakespeare</title>
  <link rel="stylesheet" href="{% static 'css/nvs.css' %}">
  <style>
    @font-face {
        font-family: "Halyard Text";
        src: url("/static/proprietary/font/HalyardText-Reg.woff2") format('woff2'), url("/static/proprietary/font/HalyardText-Reg.woff") format('woff');
    }

    .nvs_base--main { margin-top: 4rem; }
    @media ( min-width: 576px ) {
      .nvs_base--main { margin-top: 2.3rem; }
    }
  </style>
  {% block headrefs %}
  {% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">

{% include 'blocks/organisms/small-header.html' %}
{% include 'blocks/organisms/large-header.html' %}

<main class="nvs_base--main">
  {% block main %}
  {% endblock %}

  <!-- Here could be some javascript libraries referenced by every page -->

  <!-- Here is a block for child pages to have their own specific javascript libraries: -->
  {% block js %}
  {% endblock %}
</main>
{% include 'blocks/organisms/footer.html' %}
</body>

<script type="text/javascript">

  function navInit() {
    let holders = document.querySelectorAll('.navigation--holder');
    holders.forEach(holder => {

      let dropDowns = holder.querySelectorAll('.navigation--dropdown');
      dropDowns.forEach(dropDown => {
        let button = dropDown.firstElementChild;
        button.addEventListener('click', () => {
          if (dropDown.classList.contains('active')) {
            dropDown.classList.remove('active');
          } else {
            let previouslyActive;
            if (dropDown.classList.contains('nested')) {
              previouslyActive = holder.querySelector('.navigation--dropdown.active.nested');
            } else {
              previouslyActive = holder.querySelector('.navigation--dropdown.active.parent');
            }
            if (previouslyActive) {
              previouslyActive.classList.remove('active');
            }
            dropDown.classList.add('active');
          }
        });
      })

    })
  }

  function anchorInit() {
    let anchorLinks = document.querySelectorAll('.anchor-link');
    if(anchorLinks) {
      anchorLinks.forEach(link => {
        let id = link.getElementsByTagName("a")[0].getAttribute('href');
        let element = document.querySelector(id);

        let activeHandler = function(linkEl) {
          let previousActive = document.querySelectorAll('.anchor-link.active');
          if ( previousActive ) {
            previousActive.forEach(link => link.classList.remove('active'));
          }
          linkEl.classList.add('active');
        }

        if (element) {
          let options = {
            root: null,
            rootMargin: '0px',
            threshold: 1.0
          }
          let callback = (entries, observer) => {
            entries.forEach(entry => {
              if( entry.isIntersecting ) {
                activeHandler(link)
              }
            });
          };

          let observer = new IntersectionObserver(callback, options);
          observer.observe(element);
        }

        link.addEventListener('click', () => {
          activeHandler(link);
        })

      })
    }

  }

  document.addEventListener('DOMContentLoaded', () => {
    navInit();
    anchorInit();
  })
</script>

</html>